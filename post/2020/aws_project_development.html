
<head>
<title>在Local machine開發AWS serverless project</title>
<meta charset="utf-8" />
<meta name="description" content="這個 Project 主要是拿來研究 AWS serverless 的開發規劃和未來建構 Project 的基礎參考。主要會用到 AWS Resource 有 API-gateway, Lambda, RDS, Congnito Services。" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="GGFU" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css" integrity="sha512-Oy18vBnbSJkXTndr2n6lDMO5NN31UljR8e/ICzVPrGpSud4Gkckb8yUpqhKuUNoE+o9gAb4O/rAxxw1ojyUVzg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://ggfu0114.github.io/css/code_block.css"/>
</head>
<style>
	.markdown-body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}

	@media (max-width: 767px) {
		.markdown-body {
			padding: 15px;
		}
	}
</style>
<article class="markdown-body">
	<h1 id="aws-dev-project">AWS dev project</h1>
<ul>
<li>說明：這個 Project 主要是拿來研究 AWS serverless 的開發規劃和未來建構 Project 的基礎參考。主要會用到 AWS Resource 有 API-gateway, Lambda, RDS, Congnito Services。</li>
</ul>
<h1 id="install">Install</h1>
<ul>
<li>安裝 serverless package<br />
<code>npm install -g serverless</code></li>
<li>安裝開發所需其他的套件<br />
<code>npm install</code></li>
</ul>
<h1 id="dev-run">Dev run</h1>
<ul>
<li>Project 開發時，可在本機上做 Debug，確定Lambda的function沒有邏輯錯誤再佈署上去AWS就可以。Dev server開啟時會建立在 port 3000 上，請用自己主機 ip 連，不要用 <font color=red>127.0.0.1</font> 或 <font color=red>localhost</font> 連線，否則會出現錯誤。<br />
<code>npm run dev</code></li>
</ul>
<h1 id="deploy-to-aws">Deploy to AWS</h1>
<ul>
<li>將自己的程式碼透過serverless package上傳到 CloudFormation後佈署所需資源。<br />
<code>npm run deploy</code></li>
<li>為 API-gateway建立一個 Usage Plan<br />
<code>aws apigateway create-usage-plan --name dev-file-sharing-plan --api-stages apiId={{API_ID}},stage=dev --region ap-northeast-1</code></li>
<li>為 Usage Plan 綁定一組 API-key<br />
<code>aws apigateway create-usage-plan-key --usage-plan-id {{PLAN_ID}} --key-id {{KEY_ID}} --key-type "API_KEY"</code></li>
</ul>
<h1 id="migrations">Migrations</h1>
<ul>
<li>建立一個 Migration 檔案 (若變更 Schema 則需要新增一個 Migration 檔案)</li>
<li><code>db-migrate create &lt;migrate_file&gt; --config ../config.json</code></li>
<li>執行 migrate</li>
<li><code>db-migrate up --config ../config.json -e dev -v</code></li>
<li><code>db-migrate up --config ../config.json -e prod -v</code></li>
<li>回復最原始的 migration (execute all down migrations and literally reset all migrations)</li>
<li><code>db-migrate reset ../config.json -e prod -v</code><br />
:smile: 目前自動化 Delpoy 還有研究空間</li>
</ul>
<h6 id="tags-aws">tags: <code>AWS</code></h6>
</article>
