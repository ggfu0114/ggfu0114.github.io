<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Flask 要如何做測試 | GGfu Personal Study - 學習筆記</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="如何利用python unittest去測試開發好的web application讓系統更加穩定"><meta name=generator content="Hugo 0.100.2"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Flask 要如何做測試"><meta property="og:description" content="如何利用python unittest去測試開發好的web application讓系統更加穩定"><meta property="og:type" content="article"><meta property="og:url" content="https://ggfu0114.github.io/posts/flask-%E8%A6%81%E5%A6%82%E4%BD%95%E5%81%9A%E6%B8%AC%E8%A9%A6/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-01T00:00:00+00:00"><meta itemprop=name content="Flask 要如何做測試"><meta itemprop=description content="如何利用python unittest去測試開發好的web application讓系統更加穩定"><meta itemprop=datePublished content="2021-07-01T00:00:00+00:00"><meta itemprop=dateModified content="2021-07-01T00:00:00+00:00"><meta itemprop=wordCount content="87"><meta itemprop=keywords content="unittest,flask,pytest,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flask 要如何做測試"><meta name=twitter:description content="如何利用python unittest去測試開發好的web application讓系統更加穩定"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">GGfu Personal Study - 學習筆記</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/categories/ title="Category page">Category</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Flask 要如何做測試</h1><p class=tracked>By <strong>GGFU</strong></p><time class="f6 mv4 dib tracked" datetime=2021-07-01T00:00:00Z>July 1, 2021</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id=flask-unittest>flask-unittest</h1><h2 id=為什麼需要寫測試>為什麼需要寫測試</h2><p>寫測試對許多初學者來說，會覺的非常費時且沒有必要，心裡想著，我都親自測試過了，程式執行起來沒有什麼問題，為什麼需要花很多時間測試呢？</p><p>對於這個疑問，最簡單的回答是，寫測試大多是為了<code>未來</code></p><p>專案只有幾個情況下比較不需要寫測試：</p><ol><li>專案只會執行幾次就不再使用</li><li>還在初期的規規劃跟實驗的狀態(POC)</li></ol><p>當你的專案有以下的情況,測試程式碼就會勢在必行：</p><ol><li>越寫多程式碼,程式的複雜度跟耦合度漸漸變高時</li><li>專案成員變多,程式碼改動變頻繁的時候
測試程式碼就變的極為重要
測試可以讓你所開發的程式碼不會受到別人的改動而遭受影響(Side effect),當然要配合Dev Ops的CI/CD 效果才會比較好.</li></ol><blockquote><p>Pytest vs. unittest</p></blockquote><p>在Python內建的模組裡有包含了測試，所以不需要安裝任何第3方套件就可以載入<code>unittest</code>模組來寫測試.
我個人式比較常用<code>pytest</code>.</p><p><code>pytest</code>的好處是：</p><ol><li>提供比unittest更多的輔助工具來幫助測試</li><li>所有用unitest語法寫的測試程式碼,都可以用pytest來執行</li></ol><h2 id=執行測試>執行測試</h2><p>在Terminal上面執行pytest指令並加上一個資料夾，pytest就會自動去收集這個資料夾裡面帶有<code>test_*.py</code> 或是 <code>*_test.py</code>檔名的測試並執行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>pytest tests -v -s
</span></span></code></pre></div><p><code>-v</code>: 描述詳細的測試訊息
<code>-s</code>: 顯示程式碼裡面印出來的資訊</p><h2 id=unittest-mock>Unittest Mock</h2><p><code>Mock</code> 的功能對於測試非常的重要，例如：A function 裡面包含執行 B, C, D功能，但是在測試 A 功能時，我們並不想要測試 C 功能，只需要 bypass C 功能，這個時候 Mock 功能就派上用場.</p><p><code>patch</code> 是Mock裡面所提供的一個功能，它可以去取代掉原本功能的過程，例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#a6e22e>@patch</span>(<span style=color:#e6db74>&#39;func.MathFunc.get_random_point&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_multiply</span>(self, mock_func):
</span></span><span style=display:flex><span>    mock_func<span style=color:#f92672>.</span>return_value <span style=color:#f92672>=</span> (<span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>6</span>)
</span></span></code></pre></div><p>以上的程式碼代表，原本的get_random_point功能想要被取代，不論原本那個功能裡面的邏輯是什麼, 最終回傳值就一定會是一個tuple包含8,6這兩個值。</p><h2 id=flask-test>Flask test</h2><p>利用Flask在寫Web Application時, 通常會進行API test. 意思就是，我們會在API request中傳入參數, 並預期會有什麼response結果。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>app<span style=color:#f92672>.</span>test_client()
</span></span></code></pre></div><p>在 Flask 的app裡提供test_client功能，當執行後此function會回傳一個專門拿來測試用的client，我們的測試項目就可以利用這個client去發送測試的request.</p><p>利用test_client測試時，我們不需要特地自己去執行flask server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>client<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span></code></pre></div><p>使用test client 我們可以針對server所有的網址跟method(get, post, update, delete)進行測試</p><ul class=pa0><li class="list di"><a href=/tags/unittest class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">unittest</a></li><li class="list di"><a href=/tags/flask class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">flask</a></li><li class="list di"><a href=/tags/pytest class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">pytest</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/posts/flask-%E7%AC%AC%E4%B8%80%E5%80%8B-app%E5%88%9D%E5%AD%B8%E5%85%A5%E9%96%80/>Flask 第一個 APP(初學入門)</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://ggfu0114.github.io/>&copy; GGfu Personal Study - 學習筆記 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>