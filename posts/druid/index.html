<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Druid | GGfu Personal Study - 學習筆記</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Druid"><meta name=generator content="Hugo 0.100.2"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Druid"><meta property="og:description" content="Druid"><meta property="og:type" content="article"><meta property="og:url" content="https://ggfu0114.github.io/posts/druid/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-06T00:00:00+00:00"><meta itemprop=name content="Druid"><meta itemprop=description content="Druid"><meta itemprop=datePublished content="2022-03-06T00:00:00+00:00"><meta itemprop=dateModified content="2022-03-06T00:00:00+00:00"><meta itemprop=wordCount content="209"><meta itemprop=keywords content="apache,druid,Tranquility`,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Druid"><meta name=twitter:description content="Druid"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">GGfu Personal Study - 學習筆記</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/categories/ title="Category page">Category</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Druid</h1><p class=tracked>By <strong>GGFU</strong></p><time class="f6 mv4 dib tracked" datetime=2022-03-06T00:00:00Z>March 6, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id=druid-terms>Druid Terms</h2><p><code>multi-tenant</code>: a single instance of software runs on a server and serves multiple tenants
<code>OLAP</code>: Online analytical processing, is an approach to answering multi-dimensional analytical (MDA) queries swiftly in computing
<code>SaaS</code>: a software distribution model in which a third-party provider hosts applications and makes them available to customers over the Internet
<code>ROLL-UP</code>: 將原始數據在匯入資料庫時就進行彙整處理</p><h2 id=scenario>Scenario</h2><ol><li>資料已經整理好，不需要更新操作</li><li>不需要做表格的join</li><li>對於資料時間維度要求比較高的工作</li><li>即時性極重要的project</li></ol><h2 id=external-dependencies>External Dependencies</h2><p><code>Zookeeper</code>: cluster內部溝通資訊所用
<code>Metadata Storage</code>: 儲存segment的meta data和configuration，提供coordinator node去調配segment的的載入情況
<code>Deep Storage</code>: segment的永久儲存空間，提供Historical node去下載segment</p><h2 id=key-features>Key Features</h2><ul><li>Sub-second OLAP Queries</li><li>Real-time Streaming Ingestion</li><li>Power Analytic Applications</li><li>Cost Effective</li><li>Highly Available</li><li>Scalable</li></ul><p>extremely low latency queries
powering applications used by thousands of users
not support full text search(vs Elasticsearch)</p><ol><li><strong>Real-time Nodes</strong></li></ol><ul><li>用於儲存Hot data，並定期地將數據切分成segment轉移到Historical Node</li></ul><ol start=2><li><strong>Historical Nodes</strong></li></ol><ul><li>於Deep Storage載入segment並回應Broker Nodes的請求</li><li>採用無共享架構設計</li></ul><ol start=3><li><strong>Broker Nodes</strong></li></ol><ul><li>接收外部的query request</li><li>透過查詢 Zookeeper將請求劃分成 segments分別轉给 Historical和 Realtime Nodes</li><li>聚集和合併查詢结果，並返回查詢結果给外部</li></ul><ol start=4><li><strong>Coordinator Nodes</strong></li></ol><ul><li>在Druid擔任master角色，透過zookeeper管理Real-time和Historical Nodes，且透過MySQL管理segments的metadata</li><li>Coordinator Nodes 指揮Historical Nodes去做load或drop segments，針對Historical Node做balance</li></ul><ol start=5><li><strong>Overlord Nodes</strong><ul><li>管理Druid的索引任務，會將任務交給 MiddleManager，最後由Peon這個 worker去執行。</li></ul></li></ol><blockquote><p>Stream Pull</p></blockquote><p>如果Druid以Stream Pull的方式自動的從外部拉取資料而生成Indexing Service Tasks，我们则需要建立Real-Time Node</p><blockquote><p>Stream Push</p></blockquote><p>如果是採用Stream Push策略，需要建立一個"copy service"，負責從資料提供處取得資料並生成Indexing Service Tasks，從而將數據"推入"到Druid中(Tranquility)</p><h2 id=indexing-service>Indexing Service</h2><p>indexing Service是負責"產生" Segment的高可用、分布式、Master/Slave架構 。主要由三類元素組成：</p><ol><li>負責運行索引任務(indexing task)的Peon</li><li>負責控制Peon的MiddleManager</li><li>負責任務分配给MiddleManager的Overlord
其中，Overlord和MiddleManager可以分散式部署，但是Peon和MiddleManager默認在同一台機器上。</li></ol><h2 id=dataschema>DataSchema</h2><p>Timestamp column: queries center around the time axis, 此列會決定資料所在的Segment，系統中會儲存的column為__time
Dimension columns: most commonly used in filtering the data
Metric columns: columns used in aggregations and computations
granularitySpec: 粒度設定，裡面的segmentGranularity參數即是設定，多久要進行一次segment</p><h2 id=tranquility>Tranquility</h2><p>取得Streaming data提交給Overload node去做Realtime的Index</p><p>Q: 加了zookeeper功能後，tranquility出現無法找到overlord node的錯誤訊息</p><ul><li>需要在druid的config加上druid.host的參數，預設host是機器名稱，所以在zookeeper上無法找到對應的cluster node</li></ul><h2 id=ref>Ref</h2><p><a href=http://blog.csdn.net/gg782112163/article/details/59535679>Druid 系统框架</a></p><ul class=pa0><li class="list di"><a href=/tags/apache class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">apache</a></li><li class="list di"><a href=/tags/druid class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">druid</a></li><li class="list di"><a href=/tags/tranquility class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Tranquility`</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://ggfu0114.github.io/>&copy; GGfu Personal Study - 學習筆記 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>